#!/usr/bin/ansible-playbook
---
- name: site.yml
  become: true
  hosts: all
  gather_facts: false
  vars:
    # Ansible will try to use the latest python it has available,
    # which is often wrong. We don't necessarily have all the
    # modules for that implementation, so just use /usr/bin/python.
    ansible_python_interpreter: /usr/bin/python
    usevault: true
  pre_tasks:
    - name: get passwords
      include_vars:
        file: "{{ item }}"
      with_first_found:
        - "{{ inventory_hostname }}.pass.yml"
        - pass.yml
      when: usevault | bool
      tags: always
    - name: Gathering facts
      setup:
      tags: always
  roles:
    - role: hosts
      tags: hosts
    - role: sshd
      tags: sshd
    - role: sudo
      tags: sudo
    - role: timezone
      tags: timezone
    - role: fstab
      tags: fstab
    - role: networkd
      tags: networkd
    - role: resolved
      tags: resolved
    - role: zfs
      tags: zfs
    - role: smartd
      tags: smartd
    - role: portage
      tags: portage
    - role: python_exec
      tags: python_exec
    - role: ansible_pull
      tags: ansible_pull
    - role: podman_gentoo
      tags: podman_gentoo
    - role: dnsmasq
      tags: dnsmasq
    - role: unbound
      tags: unbound
    - role: dnscrypt_proxy
      tags: dnscrypt_proxy
    - role: greetd
      tags: greetd
    - role: nginx
      tags: nginx
    - role: node_exporter
      tags: node_exporter
    - role: postfix
      tags: postfix
    - role: nullmailer
      tags: nullmailer
    - role: prometheus
      tags: prometheus
    - role: gitea
      tags: gitea
    - role: portage_update
      tags: portage_update
    - role: podman
      tags: podman
    - role: transmission
      tags: transmission
    - role: speedtest_exporter
      tags: speedtest_exporter
    - role: dotfiles
      tags: dotfiles
    - role: services
      tags: services
    - role: docker
      tags: docker
    - role: dnsserver
      tags: dnsserver
    - role: grafana
      tags: grafana
    - role: grub
      tags: grub
    - role: password_store
      tags: password_store
    - role: groups
      tags: groups
    - role: u2f_keys
      tags: u2f_keys
