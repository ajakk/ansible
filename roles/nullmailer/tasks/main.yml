---
- name: Install nullmailer configuration
  notify: Restart nullmailer
  when: not postfix or postfix is not defined
  block:
    - name: Install nullmailer remotes configuration
      ansible.builtin.copy:
        src: remotes
        dest: /etc/nullmailer/remotes
        owner: root
        group: nullmail
        mode: 0640
    - name: Install nullmailer me configuration
      ansible.builtin.copy:
        content: "{{ ansible_hostname }}"
        dest: /etc/nullmailer/me
        owner: root
        group: root
        mode: 0644
    - name: Install nullmailer defaultdomain configuration
      ansible.builtin.copy:
        content: "{{ ansible_domain }}"
        dest: /etc/nullmailer/defaultdomain
        owner: root
        group: root
        mode: 0644

- name: Start and enable nullmailer
  when: not postfix or postfix is not defined
  ansible.builtin.service:
    name: nullmailer
    enabled: true
    state: started
